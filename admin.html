<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Moon Auto Detailing â€” Admin</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
     :root {
  --moon-primary: #6f93c4;
  --moon-primary-dark: #4f78a8;
  --moon-light-bg: #e9f1fb;
  --moon-soft: #9fb7d3;
  --moon-shadow: rgba(0,0,0,0.08);
}
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: #0e0e0e;
  min-height: 100vh;
}

#pageOverlay {
  color: white;
}


h1 { margin-bottom: 10px; }
.day { margin-top: 24px; }
.card {
  border: 1px solid #ffffff40;
  border-radius: 10px;
  padding: 14px;
  margin-top: 12px;
  background: rgba(111, 147, 196, 0.12); /* light moon blue */
  backdrop-filter: blur(2px);
     box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.row { margin-bottom: 6px; }
.label { font-weight: 600; }
.actions button {
margin-right: 8px;
padding: 8px 12px;
font-weight: 700;
cursor: pointer;
}
.confirm { background: #0a7a2f; color: white; border: none; }
.cancel { background: #b00020; color: white; border: none; }
.delay { background: #666; color: white; border: none; }
     
     #watermarkLogo {
  position: fixed;
  inset: 0;
  margin: auto;
  width: 1400px;
  max-width: 95vw;
  opacity: 0.08;
  z-index: 1;
  pointer-events: none;
}


     #watermarkUnderlay {
  position: fixed;
  inset: 0;                /* full screen */
  background: #000000;     /* EXACT charcoal */
  opacity: 0.12;           /* subtle */
  z-index: 0;
  pointer-events: none;
}
     #pageOverlay {
  position: relative;
  z-index: 2;
  padding: 20px;
  max-width: 1100px;
  margin: 0 auto;      /* CENTER IT */
  border-radius: 12px;
  background: transparent;
}


#pageOverlay.overlay-active {
  background: rgba(233, 241, 251, 0.85); /* only when a view is open */
}
     .moon-tab {
  padding: 10px 16px;
  font-weight: 700;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: var(--moon-primary);
  color: white;
  transition: all 0.15s ease;
  margin-right: 12px;
}
     .moon-tab[data-view="pending"] {
  box-shadow: 0 0 0 2px rgba(255, 204, 0, 0.6);
}

.moon-tab:hover {
  background: var(--moon-primary-dark);
}

.moon-tab.active {
  background: var(--moon-primary-dark);
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}
.status-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
}

.status-pending { background: #ffd966; color: #000; }
.status-confirmed { background: #4f78a8; color: #fff; }
.status-reschedule_requested { background: #8fb1e0; color: #000; }
.status-completed { background: #888; color: #fff; }
.status-cancelled { background: #b00020; color: #fff; }
.status-denied { background: #6a1b9a; color: #fff; }
.status-no_show { background: #555; color: #fff; }
.status-confirming { background: #4f78a8; color: #fff; }
.day h2 {
  font-size: 20px;
  margin-bottom: 8px;
  border-bottom: 1px solid #ffffff30;
  padding-bottom: 6px;
}
.status-badge { margin-top: 6px; }

     .dashboard-title {
  text-align: center;
  margin-top: 60px;
  color: var(--moon-primary);
}
     .booking-header {
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  color: white;
}

.booking-content {
  margin-top: 10px;
  display: none;
}

.card.expanded .booking-content {
  display: block;
}


@media (max-width: 768px) {
  .dashboard-title {
    margin-top: 40px;
  }
}
     #viewButtons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 14px;
  margin-top: 70px; /* pushes below toggle button */
  margin-bottom: 30px;
}


</style>
</head>

<body>

<!-- HARD DEBUG PANEL -->
<div
id="hardLog"
style="
     position: fixed;
     bottom: 0;
     left: 0;
     width: 100%;
     max-height: 180px;
     overflow-y: auto;
     background: #111;
     color: #0f0;
     font-family: monospace;
     font-size: 12px;
     padding: 8px;
     z-index: 9999;
     border-top: 2px solid #0f0;
     display: none;
   "
>
<strong>DEBUG LOG</strong>
</div>
     <div id="watermarkUnderlay"></div>
<img 
  src="/NewLogoColor.png" 
  id="watermarkLogo" 
  alt="Moon Auto Detailing Logo" 
/>

<div id="pageOverlay">
  <div id="viewButtons" style="margin-bottom: 20px;"></div>
  <div id="viewContainer"></div>
</div>
     <button id="debugToggle" style="
  position: fixed;
  top: 20px;
  right: 20px;
  background: #6f93c4;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  z-index: 5;
">
  Toggle Debug
</button>


<script type="module">
     // ================= ADMIN LOGIN =================
let ADMIN_SESSION = sessionStorage.getItem("moon_admin_session");

async function requireLogin() {
  if (ADMIN_SESSION) return;

  const password = prompt("Admin password required:");
  if (!password) throw new Error("No password");

  const res = await fetch("/api/admin-login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password })
  });

  const data = await res.json();

  if (!res.ok) {
    alert("Wrong password");
    throw new Error("Unauthorized");
  }

  ADMIN_SESSION = data.token;
  sessionStorage.setItem("moon_admin_session", ADMIN_SESSION);
}

await requireLogin();

/* ===================== IMPORTS ===================== */
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

/* ===================== HARD LOG ===================== */
function hardLog(message) {
const el = document.getElementById("hardLog");
if (!el) return;
const line = document.createElement("div");
line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
el.appendChild(line);
el.scrollTop = el.scrollHeight;
}

hardLog("ADMIN LOADED");
     // ===================== DEBUG TOGGLE =====================
const debugToggle = document.getElementById("debugToggle");
const hardLogPanel = document.getElementById("hardLog");

debugToggle.onclick = () => {
  if (hardLogPanel.style.display === "none") {
    hardLogPanel.style.display = "block";
  } else {
    hardLogPanel.style.display = "none";
  }
};


/* ===================== SUPABASE ===================== */
const SUPABASE_URL = "https://qgmhugztrpiprnqmcyan.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnbWh1Z3p0cnBpcHJucW1jeWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MDk1NjMsImV4cCI6MjA4NjA4NTU2M30.Mo0uRGWCjU1fOa1br2P8j1ogEZf7mDm2JseV8DFnPwI";

// ===== ADMIN AUTH (runtime, not in source) =====
let ADMIN_SECRET = sessionStorage.getItem("moon_admin_secret");
if (!ADMIN_SECRET) {
  ADMIN_SECRET = prompt("Enter admin password:");
  if (!ADMIN_SECRET) {
    alert("Admin password required.");
    throw new Error("Missing admin password");
  }
  sessionStorage.setItem("moon_admin_secret", ADMIN_SECRET);
}


const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


     // ===================== VIEW STATE =====================
let currentView = null;

let cachedViews = {
  pending: [],
  today: [],
  upcoming: [],
};
     let historyPage = 1;
const historyPageSize = 20;
let filteredHistory = [];


const viewButtons = document.getElementById("viewButtons");
const viewContainer = document.getElementById("viewContainer");

     /* ===================== ACTION LOCKING ===================== */
const inFlightActions = new Map();
// key: `${bookingId}:${action}`

function lockBookingAction(bookingId, action) {
  const key = `${bookingId}:${action}`;
  if (inFlightActions.has(key)) return false;
  inFlightActions.set(key, true);
  return true;
}

function unlockBookingAction(bookingId, action) {
  const key = `${bookingId}:${action}`;
  inFlightActions.delete(key);
}

function setBookingButtonsDisabled(card, disabled) {
  const buttons = card.querySelectorAll("button");
  buttons.forEach(btn => {
    btn.disabled = disabled;
    if (disabled) {
      btn.dataset.originalText = btn.textContent;
      btn.textContent = "Working...";
    } else {
      if (btn.dataset.originalText) {
        btn.textContent = btn.dataset.originalText;
      }
    }
  });
}


/* ===================== FORMAT HELPERS ===================== */
function formatDay(d) {
return d.toLocaleDateString(undefined, {
weekday: "long",
year: "numeric",
month: "long",
day: "numeric"
});
}

function formatTime(d) {
return d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
}

/* ===================== LOAD BOOKINGS ===================== */
async function loadAdminData() {
hardLog("LOADING ADMIN DATA");

const today = new Date();
today.setHours(0, 0, 0, 0);

const { data, error } = await supabase
.from("bookings")
.select(`
     id,
     scheduled_start,
     scheduled_end,
     service_address,
     status,
     google_event_id,
     customers:customer_id ( full_name, phone ),
     vehicles:vehicle_id ( vehicle_year, vehicle_make, vehicle_model ),
     service_variants:service_variant_id (
       duration_minutes,
       services:service_id ( category, level )
     )
   `)
.gte("scheduled_start", today.toISOString())
.order("scheduled_start", { ascending: true });

if (error) {
  hardLog("LOAD ERROR");
  console.error(error);
  viewContainer.innerHTML = "Failed to load bookings.";
  return;
}

splitAndRender(data);
renderButtons();

if (currentView) {
  renderView(currentView);
  highlightActiveButton(currentView);
} else {
  renderDashboard();
}
}

function splitAndRender(bookings) {

cachedViews.pending = [];
cachedViews.today = [];
cachedViews.upcoming = [];
cachedViews.history = [];

const now = new Date();
const startOfToday = new Date();
startOfToday.setHours(0,0,0,0);

const endOfToday = new Date(startOfToday);
endOfToday.setDate(endOfToday.getDate() + 1);

bookings.forEach(b => {
const start = new Date(b.scheduled_start);

if (b.status === "pending") {
  cachedViews.pending.push(b);
}

else if (b.status === "confirmed") {
if (start >= startOfToday && start < endOfToday) {
cachedViews.today.push(b);
} else if (start >= endOfToday) {
cachedViews.upcoming.push(b);
}
}

});
}

function renderSection(title, bookings, collapsed = false) {
const section = document.createElement("div");
section.className = "day";

const header = document.createElement("h2");
header.textContent = `${title} (${bookings.length})`;
section.appendChild(header);

const body = document.createElement("div");

if (collapsed) {
body.style.display = "none";
header.style.cursor = "pointer";
header.onclick = () => {
body.style.display =
body.style.display === "none" ? "block" : "none";
};
}

// ðŸ”¹ Group bookings by calendar day
const groups = {};

bookings.forEach(b => {
const dayKey = new Date(b.scheduled_start).toDateString();
if (!groups[dayKey]) groups[dayKey] = [];
groups[dayKey].push(b);
});

Object.entries(groups).forEach(([day, items]) => {
const dayHeader = document.createElement("h3");
dayHeader.textContent = formatDay(new Date(day));
body.appendChild(dayHeader);

items.forEach(b => {
body.appendChild(buildCard(b));
});
});

section.appendChild(body);
viewContainer.appendChild(section);
}

function buildCard(b) {
  const start = new Date(b.scheduled_start);
  const end = new Date(b.scheduled_end);

  const service = b.service_variants?.services || {};
const vehicle = b.vehicles || {};
const customer = b.customers || {};


  const card = document.createElement("div");
  card.className = "card";
     // Add accent border for today's confirmed bookings
if (b.status === "confirmed") {
  const today = new Date();
  today.setHours(0,0,0,0);

  const start = new Date(b.scheduled_start);
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);

  if (start >= today && start < tomorrow) {
    card.style.borderLeft = "4px solid var(--moon-primary)";
  }
}

  card.innerHTML = `
  <div class="booking-header">
    ${customer.full_name || "Unknown Client"}
  </div>

  <div class="booking-content">
    <div class="row"><span class="label">Phone:</span> ${customer.phone || "â€”"}</div>
    <div class="row"><span class="label">Address:</span> ${b.service_address}</div>
    <div class="row"><span class="label">Vehicle:</span> ${vehicle.vehicle_year || ""} ${vehicle.vehicle_make || ""} ${vehicle.vehicle_model || ""}</div>
    <div class="row"><span class="label">Service:</span> ${service.category || "Service"} (Level ${service.level || "?"})</div>
    <div class="row"><span class="label">Time:</span> ${formatTime(start)} â†’ ${formatTime(end)}</div>
    <div class="row">
  <span class="label">Status:</span>
  <span class="status-badge status-${b.status}">
    ${b.status.replace("_"," ")}
  </span>
</div>

  </div>
`;

const header = card.querySelector(".booking-header");

header.onclick = () => {
  card.classList.toggle("expanded");
};

  const actions = document.createElement("div");
  actions.className = "actions";

  // Pending
  if (b.status === "pending") {

    const confirmBtn = document.createElement("button");
    confirmBtn.textContent = "Confirm";
    confirmBtn.className = "confirm";
    confirmBtn.onclick = async () => {

  if (!lockBookingAction(b.id, "confirm")) return;

  setBookingButtonsDisabled(card, true);

  hardLog(`CONFIRM CLICKED booking ${b.id}`);

  try {
    const res = await fetch("/api/confirm-booking", {
      method: "POST",
      headers: {
  "Content-Type": "application/json",
  "x-admin-session": ADMIN_SESSION
}
      body: JSON.stringify({ bookingId: b.id })
    });

    const data = await res.json();
    hardLog(`CONFIRM API RESPONSE ${res.status}`);

    if (!res.ok || !data.ok) {
      throw new Error(data.message || "Confirmation failed");
    }

    await loadAdminData();

  } catch (err) {
    alert("Confirmation failed.");
    hardLog(`CONFIRM ERROR ${err.message}`);
  } finally {
    unlockBookingAction(b.id, "confirm");
    setBookingButtonsDisabled(card, false);
  }
};
       
    const denyBtn = document.createElement("button");
    denyBtn.textContent = "Deny";
    denyBtn.className = "cancel";
    denyBtn.onclick = async () => {
      if (!confirm("Are you sure you want to deny this booking?")) return;
      await updateStatus(b.id, "denied", card);
      loadAdminData();
    };

    actions.appendChild(confirmBtn);
    actions.appendChild(denyBtn);
  }

  // Confirmed
  else if (b.status === "confirmed") {

  const rescheduleBtn = document.createElement("button");
  rescheduleBtn.textContent = "Reschedule";
  rescheduleBtn.className = "delay";
  rescheduleBtn.onclick = async () => {

    if (!lockBookingAction(b.id, "reschedule")) return;
    setBookingButtonsDisabled(card, true);

    try {
      if (!confirm("Mark this booking as reschedule requested?")) return;

      const delRes = await fetch("/api/delete-calendar-event", {
        method: "POST",
       headers: {
  "Content-Type": "application/json",
  "x-admin-session": ADMIN_SESSION
}
        body: JSON.stringify({ bookingId: b.id })
      });

      const delData = await delRes.json();
      if (!delRes.ok || !delData.ok) {
        throw new Error(delData.message || "Calendar deletion failed");
      }

      const { error } = await supabase
        .from("bookings")
        .update({ status: "reschedule_requested" })
        .eq("id", b.id);

      if (error) throw error;

      await loadAdminData();

    } catch (err) {
      alert("Reschedule failed.");
      hardLog(`RESCHEDULE ERROR ${err.message}`);
    } finally {
      unlockBookingAction(b.id, "reschedule");
      setBookingButtonsDisabled(card, false);
    }
  };

  const completeBtn = document.createElement("button");
  completeBtn.textContent = "Job Completed";
  completeBtn.className = "confirm";
  completeBtn.onclick = async () => {

    if (!lockBookingAction(b.id, "complete")) return;
    setBookingButtonsDisabled(card, true);

    try {
      await updateStatus(b.id, "completed", card);
      await loadAdminData();
    } finally {
      unlockBookingAction(b.id, "complete");
      setBookingButtonsDisabled(card, false);
    }
  };

  const cancelBtn = document.createElement("button");
  cancelBtn.textContent = "Cancel";
  cancelBtn.className = "cancel";
  cancelBtn.onclick = async () => {

    if (!lockBookingAction(b.id, "cancel")) return;
    setBookingButtonsDisabled(card, true);

    try {
      if (!confirm("Cancel this booking?")) return;

      const delRes = await fetch("/api/delete-calendar-event", {
        method: "POST",
        headers: {
  "Content-Type": "application/json",
  "x-admin-session": ADMIN_SESSION
}
        body: JSON.stringify({ bookingId: b.id })
      });

      const delData = await delRes.json();
      if (!delRes.ok || !delData.ok) {
        throw new Error(delData.message || "Calendar deletion failed");
      }

      const { error } = await supabase
        .from("bookings")
        .update({ status: "cancelled" })
        .eq("id", b.id);

      if (error) throw error;

      await loadAdminData();

    } catch (err) {
      alert("Cancellation failed.");
      hardLog(`CANCEL ERROR ${err.message}`);
    } finally {
      unlockBookingAction(b.id, "cancel");
      setBookingButtonsDisabled(card, false);
    }
  };

  actions.appendChild(rescheduleBtn);
  actions.appendChild(completeBtn);
  actions.appendChild(cancelBtn);
}
     card.querySelector(".booking-content").appendChild(actions);
      
  return card;
}

/* ===================== CALENDAR API ===================== */
async function createCalendarEvent(booking) {
hardLog(`CALLING CALENDAR API for ${booking.id}`);

const summary = `${booking.service_variants.services.category} Level ${booking.service_variants.services.level} â€” ${booking.customers.full_name}`;

const res = await fetch("/api/create-calendar-event", {
method: "POST",
headers: {
"Content-Type": "application/json",
"x-admin-secret": ADMIN_SECRET
},
body: JSON.stringify({
summary,
location: booking.service_address,
description: [
`Customer: ${booking.customers.full_name}`,
`Phone: ${booking.customers.phone || "â€”"}`,
`Vehicle: ${booking.vehicles.vehicle_year || ""} ${booking.vehicles.vehicle_make || ""} ${booking.vehicles.vehicle_model || ""}`.trim(),
`Service: ${booking.service_variants.services.category} Level ${booking.service_variants.services.level}`
].join("\n"),
startISO: booking.scheduled_start,
endISO: booking.scheduled_end
})
});

const text = await res.text();
hardLog(`CALENDAR RESPONSE ${res.status}`);

if (!res.ok) throw new Error(text);
return JSON.parse(text);
}

/* ===================== STATUS UPDATE ===================== */
async function updateStatus(id, status, card) {
const { error } = await supabase
.from("bookings")
.update({ status })
.eq("id", id);

if (error) {
alert("Failed to update booking status");
console.error(error);
return;
}

card.remove();
}
// ===================== DASHBOARD RENDERING =====================

function renderDashboard() {
  viewContainer.innerHTML = `
  <div style="
    text-align: center;
    margin-top: 60px;
    color: #4f8de6;
  ">
    <h1 style="margin: 0; font-weight: 800;">
      Moon Auto Detailing Dashboard
    </h1>
  </div>
`;

}

function renderButtons() {
  viewButtons.innerHTML = "";

  const buttons = [
    { key: "pending", label: "Pending Bookings" },
    { key: "today", label: "Today's Schedule" },
    { key: "upcoming", label: "Upcoming Bookings" },
    { key: "history", label: "History" }
  ];

  buttons.forEach(btn => {
    const button = document.createElement("button");
    button.textContent = btn.label;
    button.className = "moon-tab";
    button.dataset.view = btn.key;

    button.onclick = () => {
      handleViewSwitch(btn.key);
    };

    viewButtons.appendChild(button);
  });
}

function handleViewSwitch(viewName) {
  if (currentView === viewName) {
    currentView = null;
       document.getElementById("pageOverlay").classList.remove("overlay-active");
    renderDashboard();
    highlightActiveButton(null);
    return;
  }

  currentView = viewName;
  renderView(viewName);
  highlightActiveButton(viewName);
}

function highlightActiveButton(activeKey) {
  const all = viewButtons.querySelectorAll("button");

  all.forEach(btn => {
    if (btn.dataset.view === activeKey) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });
}

function renderView(viewName) {
  viewContainer.innerHTML = "";

  // =========================
  // HISTORY (SERVER-SIDE)
  // =========================
  if (viewName === "history") {
    const wrapper = document.createElement("div");

    const filterRow = document.createElement("div");
    filterRow.style.display = "flex";
    filterRow.style.justifyContent = "center";
    filterRow.style.gap = "10px";
    filterRow.style.marginBottom = "20px";

    const searchInput = document.createElement("input");
    searchInput.type = "text";
    searchInput.placeholder = "Search by client name";
    searchInput.style.padding = "6px 10px";
    searchInput.style.borderRadius = "6px";
    searchInput.style.border = "1px solid #ffffff40";
    searchInput.style.background = "rgba(255,255,255,0.08)";
    searchInput.style.color = "white";

    const dateInput = document.createElement("input");
    dateInput.type = "date";
    dateInput.style.padding = "6px 10px";
    dateInput.style.borderRadius = "6px";
    dateInput.style.border = "1px solid #ffffff40";
    dateInput.style.background = "rgba(255,255,255,0.08)";
    dateInput.style.color = "white";

    filterRow.appendChild(searchInput);
    filterRow.appendChild(dateInput);
    wrapper.appendChild(filterRow);

    const resultsContainer = document.createElement("div");
    wrapper.appendChild(resultsContainer);

    const paginationContainer = document.createElement("div");
    paginationContainer.style.display = "flex";
    paginationContainer.style.justifyContent = "center";
    paginationContainer.style.gap = "8px";
    paginationContainer.style.marginTop = "20px";
    wrapper.appendChild(paginationContainer);

    viewContainer.appendChild(wrapper);

    let currentPage = 1;
    const PAGE_SIZE = 10;

    async function loadHistoryPage(page = 1) {
      currentPage = page;
      resultsContainer.innerHTML = "Loading...";
      paginationContainer.innerHTML = "";

      const params = new URLSearchParams({
        page: page.toString(),
        pageSize: PAGE_SIZE.toString()
      });

      if (searchInput.value.trim()) params.append("q", searchInput.value.trim());
      if (dateInput.value) params.append("date", dateInput.value);

      try {
        const res = await fetch(`/api/admin-history?${params.toString()}`, {
          headers: {
  "x-admin-session": ADMIN_SESSION
}
        });

        const payload = await res.json();
        if (!res.ok) throw new Error(payload.error || "Failed to load history");

        resultsContainer.innerHTML = "";

        if (!payload.rows.length) {
          resultsContainer.innerHTML = "<div style='margin-top:40px;font-weight:600;'>No records found.</div>";
          return;
        }

        payload.rows.forEach(b => resultsContainer.appendChild(buildCard(b)));

        const totalPages = Math.ceil(payload.totalCount / PAGE_SIZE);
        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement("button");
          btn.textContent = i;
          btn.className = "moon-tab";
          if (i === currentPage) btn.classList.add("active");
          btn.onclick = () => loadHistoryPage(i);
          paginationContainer.appendChild(btn);
        }

      } catch (err) {
        resultsContainer.innerHTML = "Failed to load history.";
        hardLog("HISTORY LOAD ERROR " + err.message);
      }
    }

    let searchTimeout;
    searchInput.addEventListener("input", () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => loadHistoryPage(1), 300);
    });

    dateInput.addEventListener("change", () => loadHistoryPage(1));

    loadHistoryPage(1);
    return;
  }

  // =========================
  // NORMAL VIEWS
  // =========================
  const data = cachedViews[viewName];

  if (!data || data.length === 0) {
    viewContainer.innerHTML = "<div style='margin-top:40px;font-weight:600;'>No records found.</div>";
    return;
  }

  renderSection(viewName.toUpperCase(), data);
}

     // ===== APP BOOT =====
renderButtons();
renderDashboard();
loadAdminData();

     
</script>
</body>
</html>
